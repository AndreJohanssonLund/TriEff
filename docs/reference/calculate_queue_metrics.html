<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Queue Metrics for Rank-based Triage Effectiveness (RTE) Analysis — calculate_queue_metrics • trieff</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Queue Metrics for Rank-based Triage Effectiveness (RTE) Analysis — calculate_queue_metrics"><meta name="description" content="This function implements the Rank-based Triage Effectiveness (RTE) methodology to evaluate
triage system performance based on patient queue positioning rather than waiting times.
RTE measures how effectively a triage system prioritizes time-critical patients relative
to their positions in a theoretical first-come-first-served system, providing a patient-level
metric that complements the waiting time-based Triage Effectiveness (WTE) approach."><meta property="og:description" content="This function implements the Rank-based Triage Effectiveness (RTE) methodology to evaluate
triage system performance based on patient queue positioning rather than waiting times.
RTE measures how effectively a triage system prioritizes time-critical patients relative
to their positions in a theoretical first-come-first-served system, providing a patient-level
metric that complements the waiting time-based Triage Effectiveness (WTE) approach."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trieff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/sim_te.html">Simulation in trieff</a></li>
    <li><a class="dropdown-item" href="../articles/calc_wte_rte.html">Calculating Triage Effectiveness</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrap.html">Bootstrap Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/plot_te.html">Plotting Results</a></li>
    <li><a class="dropdown-item" href="../articles/heatmap.html">Heatmap Analysis</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-research" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Research</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-research"><li><a class="dropdown-item" href="../articles/original_study.html">Original Study (Under Review)</a></li>
    <li><a class="dropdown-item" href="../articles/publications.html">Publications Using trieff</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AndreJohanssonLund/trieff/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate Queue Metrics for Rank-based Triage Effectiveness (RTE) Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/AndreJohanssonLund/trieff/blob/HEAD/R/calc_rte.R" class="external-link"><code>R/calc_rte.R</code></a></small>
      <div class="d-none name"><code>calculate_queue_metrics.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function implements the Rank-based Triage Effectiveness (RTE) methodology to evaluate
triage system performance based on patient queue positioning rather than waiting times.
RTE measures how effectively a triage system prioritizes time-critical patients relative
to their positions in a theoretical first-come-first-served system, providing a patient-level
metric that complements the waiting time-based Triage Effectiveness (WTE) approach.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_queue_metrics</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ambiguity_invalid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ambiguity_perfect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame that has been initiated with init() with the following required columns:</p><ul><li><p>segment: Created in init(), a grouping variable identifying distinct queue segments.</p></li>
<li><p>arrival_minute: Time of patient arrival (numeric).</p></li>
<li><p>observed_resolve_time: Time when patient was actually resolved (numeric), created by init().</p></li>
<li><p>theoretica_resolve_time: Theoretical resolution time (numeric) from sim_te(). Optional.</p></li>
<li><p>binary_theoretical_resolve_time: Theoretical resolution time when using binary priorities (numeric). Optional.</p></li>
<li><p>loset: Logical flag indicating if patient is time-critical (TRUE) or not (FALSE).</p></li>
</ul></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical, determines if intermediate calculation fields are returned (TRUE) or only the final RTE results (FALSE).</p></dd>


<dt id="arg-ambiguity-invalid">ambiguity_invalid<a class="anchor" aria-label="anchor" href="#arg-ambiguity-invalid"></a></dt>
<dd><p>logical, default is TRUE, sets if cases where n_tc =&gt; L are invalid since they are ambigous and thus cannot be used to draw conclusions. I.e. p = 1 theoretically gives both TE = 100% and 0%.</p></dd>


<dt id="arg-ambiguity-perfect">ambiguity_perfect<a class="anchor" aria-label="anchor" href="#arg-ambiguity-perfect"></a></dt>
<dd><p>logical, default is TRUE, used if ambiguity_invalit == FALSE, if TRUE, cases where n_tc =&gt; L gives 100% TE, if false, gives 0% TE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame with the original data plus additional columns:</p><ul><li><p>arrivals_up_to_now: (if verbose == TRUE) Cumulative count of arrivals at each patient's arrival time.</p></li>
<li><p>observed_resolves_before: (if verbose == TRUE) Count of patients resolved before each patient's arrival.</p></li>
<li><p>L: (if verbose == TRUE) Queue length at patient arrival (including the patient).</p></li>
<li><p>observed_p: (if verbose == TRUE) Patient's position in the resolution sequence, counting from arrival to observed resolution.</p></li>
<li><p>theoretical_p: (if verbose == TRUE) Patient's position in the theoretical resolution sequence.</p></li>
<li><p>n_tc: (if verbose == TRUE) Number of time-critical patients in the concurrent window (from last resolve before arrival to first resolve after).</p></li>
<li><p>is_cluster: Logical flag indicating if the patient is part of a time-critical cluster.</p></li>
<li><p>cluster_id: Identifier for patients belonging to the same time-critical cluster.</p></li>
<li><p>valid: Logical flag indicating if the time-critical patient's RTE calculation is valid (see details).</p></li>
<li><p>observed_RTE: Rank-based Triage Effectiveness based on observed resolution times (NA for non-time-critical patients).</p></li>
<li><p>theoretical_RTE: Rank-based Triage Effectiveness based on theoretical resolution times (NA for non-time-critical patients).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="conceptual-framework">Conceptual Framework<a class="anchor" aria-label="anchor" href="#conceptual-framework"></a></h3>


<p>RTE quantifies triage performance through queue positioning rather than waiting times. It evaluates
how effectively a triage system moves time-critical patients forward in the resolution queue compared
to their position in a first-come-first-served (FCFS) system, where:</p><ul><li><p>RTE = 0 means the patient's position was equivalent to FCFS (no triage benefit)</p></li>
<li><p>RTE = 1 means optimal positioning (perfect triage)</p></li>
<li><p>RTE &lt; 0 means worse positioning than FCFS (triage was counterproductive)</p></li>
</ul></div>

<div class="section">
<h3 id="key-metrics-calculation">Key Metrics Calculation<a class="anchor" aria-label="anchor" href="#key-metrics-calculation"></a></h3>


<p><strong>L (Queue Length)</strong>: Represents the number of patients in queue when a patient arrives,
including the patient themselves. This value indicates what position the patient would have in a
FCFS system.</p>
<p><strong>p (Position)</strong>: The patient's position in the resolution sequence, counting from their arrival
time to their resolution time. A p value of 1 means the patient was the first to be resolved among
all patients in queue at their arrival time.</p>
<p><strong>n_tc</strong>: Number of time-critical patients (loset=TRUE) in the concurrent window between the last resolve
before the patient's arrival and the first resolve after their arrival, including the patient themselves.
This represents the "cluster" of time-critical cases that arrived in close temporal proximity.</p>
<p><strong>valid</strong>: A time-critical patient's RTE calculation is considered valid only when triage can
make a meaningful difference. Specifically, the calculation is valid if any of these conditions are met:</p><ul><li><p>There's at least one non-time-critical patient already in the queue at arrival time, OR</p></li>
<li><p>A non-time-critical patient will arrive before L resolves happen (if L = n_tc), OR</p></li>
<li><p>L ≠ n_tc (queue composition allows for meaningful prioritization)</p></li>
</ul><p>This validation prevents analysis of scenarios where the order doesn't matter (e.g., when all patients
in queue are time-critical and no new non-time-critical patients arrive before they're all resolved).</p>
</div>

<div class="section">
<h3 id="rte-calculation-logic">RTE Calculation Logic<a class="anchor" aria-label="anchor" href="#rte-calculation-logic"></a></h3>


<p>The RTE formula varies depending on the queue dynamics to ensure consistent interpretation across different scenarios:</p><ol><li><p><strong>Perfect Triage</strong> (when p ≤ n_tc):</p><ul><li><p>The patient is resolved within the first n_tc positions</p></li>
<li><p>If n_tc ≥ L and ambiguity_perfect=TRUE: RTE = 1 (perfect score)</p></li>
<li><p>If n_tc ≥ L and ambiguity_perfect=FALSE: RTE = 0</p></li>
<li><p>Otherwise (when n_tc &lt; L): RTE = 1 (perfect score)</p></li>
</ul></li>
<li><p><strong>Positive Triage</strong> (when n_tc &lt; p ≤ L):</p><ul><li><p>The patient is resolved after the first n_tc positions but within or at L</p></li>
<li><p>RTE = (L - p) / (L - n_tc)</p></li>
</ul></li>
<li><p><strong>Negative Triage</strong> (when p &gt; L):</p><ul><li><p>The patient is resolved after L positions (worse than first-come, first-served)</p></li>
<li><p>RTE = (L - p) / L (this will be negative)</p></li>
</ul></li>
</ol></div>

<div class="section">
<h3 id="ambiguity-handling">Ambiguity Handling<a class="anchor" aria-label="anchor" href="#ambiguity-handling"></a></h3>


<p>An ambiguous case occurs when n_tc ≥ L, meaning there are as many or more time-critical patients
than the queue length. In this situation, the position would be the same with perfect prioritization
as in a first-come, first-serve system.</p>
<p>By default (ambiguity_invalid=TRUE), these cases are considered invalid for RTE calculation.
When ambiguity_invalid=FALSE, the result depends on ambiguity_perfect:</p><ul><li><p>When ambiguity_perfect=TRUE (default): These cases are scored as "perfect" (RTE = 1)</p></li>
<li><p>When ambiguity_perfect=FALSE: These cases are scored as "zero" (RTE = 0)</p></li>
</ul></div>

<div class="section">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h3>


<p><strong>Example 1:</strong> A time-critical patient arrives and finds 5 patients already in queue (L = 6).
They are the only time-critical patient in this window (n_tc = 1). They get resolved as the 2nd patient (p = 2).</p>
<p>Using case 3 formula: RTE = (6 - 2)/(6 - (1+1)/2) = 4/5 = 0.8</p>
<p>This indicates very good triage performance, moving the patient nearly to optimal position.</p>
<p><strong>Example 2:</strong> A time-critical patient arrives at an empty queue (L = 1) and is the only time-critical
patient (n_tc = 1). Before this patient is resolved, 3 non-time-critical patients arrive. The time-critical
patient gets resolved as the 3rd patient (p = 3).</p>
<p>Using case 4 formula: RTE = (1 + ((1+1)/2-1) - 3)/1 = -1.5</p>
<p>This indicates poor triage, as the time-critical patient was significantly delayed despite arriving first.</p>
<p><strong>Example 3:</strong> During a major incident, 4 time-critical patients arrive in rapid succession to an ED
with 2 patients already waiting (L = 3 for the first arriving time-critical patient, n_tc = 4). The first
time-critical patient gets resolved as the 2nd patient (p = 2).</p>
<p>Using case 2 formula: RTE = ((4+1)/2 - 2)/((4+1)/2 - 1) = 0.5/1.5 = 0.33</p>
<p>This indicates moderate triage performance within the context of a time-critical patient cluster.</p>
</div>

<div class="section">
<h3 id="differences-between-rank-based-te-rte-and-waiting-time-based-te-wte-">Differences between Rank-based TE (RTE) and Waiting time-based TE (WTE)<a class="anchor" aria-label="anchor" href="#differences-between-rank-based-te-rte-and-waiting-time-based-te-wte-"></a></h3>

<ol><li><p><strong>Conceptual Focus:</strong></p><ul><li><p>RTE measures position improvement in the queue (process metric)</p></li>
<li><p>WTE measures waiting time reduction (outcome metric)</p></li>
</ul></li>
<li><p><strong>Analytical Granularity:</strong></p><ul><li><p>RTE provides patient-level measurements, enabling standard statistical analyses without bootstrapping</p></li>
<li><p>WTE produces aggregate measurements requiring bootstrapping for confidence intervals</p></li>
</ul></li>
<li><p><strong>Queue Dynamics Handling:</strong></p><ul><li><p>RTE handles non-coincident arrivals and resolves better than WTE</p></li>
<li><p>WTE better reflects the actual time impact experienced by patients</p></li>
</ul></li>
<li><p><strong>Edge Case Behavior:</strong></p><ul><li><p>RTE can punish placement severely in short queues where the time effect is minimal</p></li>
<li><p>WTE can punish EDs with lower resolve rates and fewer priority 1 cases</p></li>
</ul></li>
<li><p><strong>System Evaluation:</strong></p><ul><li><p>RTE focuses specifically on triage decision quality regardless of system throughput</p></li>
<li><p>WTE combines effects of both triage decisions and system throughput capacity</p></li>
</ul></li>
<li><p><strong>Interpretation Differences:</strong></p><ul><li><p>RTE measures position advantage relative to FCFS position and cluster composition</p></li>
<li><p>WTE measures time advantage relative to mean waiting time for all patients</p></li>
</ul></li>
<li><p><strong>Cross-System Comparison:</strong></p><ul><li><p>RTE may be more stable across different ED environments with varying throughput capacities</p></li>
<li><p>WTE more directly reflects patient experience in terms of actual waiting time</p></li>
</ul></li>
</ol></div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This function makes specific assumptions when handling multiple patients resolved in
the same minute:</p>
<p>For observed_p calculation: When multiple patients are resolved in the same minute,
the function assumes that higher priority patients were resolved first, followed by
patients with equal priority in arrival order. This may not reflect the actual
sequence that occurred in practice, as this level of detail is often not captured
in typical ED datasets with minute-level resolution. The calculation therefore
interprets the observed data in the "best light" - assuming ideal priority-based
ordering within each minute.</p>
<p>For theoretical_p and binary_theoretical_p: The priority-based ordering is
consistent with the simulation used in sim_te() and sim_heat(), ensuring that
within the same minute, higher priority patients are always processed before
lower priority patients, and equal priority patients are processed in arrival order.</p>
<p>Cluster handling: The function identifies time-critical clusters when there are
multiple time-critical cases (n_tc &gt; 1) and at least one has n_tc &gt; L. Patients
in these clusters are evaluated using a modified RTE formula that better accounts
for the unique dynamics of clustered time-critical arrivals.</p>
<p>This handling is necessary to achieve consistent 100% TE scores in scenarios
with perfect triage (100% sensitivity and specificity), particularly when
multiple patients are resolved within the same minute or when time-critical
patients arrive in clusters.</p>
<p>This function makes specific assumptions when handling multiple patients resolved in
the same minute:</p>
<p>For observed_p calculation: When multiple patients are resolved in the same minute,
the function assumes that higher priority patients were resolved first, followed by
patients with equal priority in arrival order. This may not reflect the actual
sequence that occurred in practice, as this level of detail is often not captured
in typical ED datasets with minute-level resolution. The calculation therefore
interprets the observed data in the "best light" - assuming ideal priority-based
ordering within each minute.</p>
<p>For theoretical_p and binary_theoretical_p: The priority-based ordering is
consistent with the simulation used in sim_te() and sim_heat(), ensuring that
within the same minute, higher priority patients are always processed before
lower priority patients, and equal priority patients are processed in arrival order.</p>
<p>This handling is necessary to achieve consistent 100% TE scores in scenarios
with perfect triage (100% sensitivity and specificity), particularly when
multiple patients are resolved within the same minute.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="init.html">init</a></code> for initializing data for triage analysis
<code><a href="sim_te.html">sim_te</a></code> for simulating theoretical resolve times
Calculate Queue Metrics for Rank-based Triage Effectiveness (RTE) Analysis using data.table</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by André Johansson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

