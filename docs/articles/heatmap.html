<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heatmap Analysis in trieff • trieff</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Heatmap Analysis in trieff">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">trieff</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootstrap.html">Bootstrap Analysis with trieff</a>
    </li>
    <li>
      <a href="../articles/calc_te.html">Calculating Triage Effectiveness</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">Getting Started with trieff</a>
    </li>
    <li>
      <a href="../articles/heatmap.html">Heatmap Analysis in trieff</a>
    </li>
    <li>
      <a href="../articles/plot_te.html">Plotting Triage Effectiveness Results</a>
    </li>
    <li>
      <a href="../articles/sim_te.html">Simulation in trieff</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/yourusername/trieff/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Heatmap Analysis in trieff</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yourusername/trieff/blob/HEAD/vignettes/heatmap.Rmd" class="external-link"><code>vignettes/heatmap.Rmd</code></a></small>
      <div class="hidden name"><code>heatmap.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yourusername/trieff" class="external-link">trieff</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded trieff 0.8.5</span></span>
<span><span class="co">#&gt; System capable of parallel processing with multisession backend</span></span>
<span><span class="co">#&gt; Maximum available workers: 16</span></span>
<span><span class="co">#&gt; Note: Individual functions will determine optimal core usage at runtime</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The heatmap functionality in trieff is primarily a research tool
designed to explore and validate the theoretical properties of Triage
Effectiveness (TE). Unlike other features in the package, heatmap
generation is computationally intensive and typically used for
understanding fundamental relationships rather than day-to-day
analysis.</p>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<ul>
<li><p>Understanding of TE concepts
(<code><a href="../articles/getting_started.html">vignette("getting_started")</a></code>)</p></li>
<li><p>Familiarity with simulation
(<code><a href="../articles/sim_te.html">vignette("sim_te")</a></code>)</p></li>
<li><p>Could require some computational resources.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="relationship-to-simulation">Relationship to Simulation<a class="anchor" aria-label="anchor" href="#relationship-to-simulation"></a>
</h2>
<p>The heatmap analysis builds on the simulation framework described in
<code><a href="../articles/sim_te.html">vignette("sim_te")</a></code>. However, it requires significantly more
computational resources due to repeated simulations across
sensitivity/specificity combinations.</p>
<div class="section level3">
<h3 id="important-considerations">Important Considerations<a class="anchor" aria-label="anchor" href="#important-considerations"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Computational Cost</strong>: Full heatmap generation with
typical ED datasets (&gt;100,000 visits) can take several minutes
depending on step size.</li>
<li>
<strong>Intended Use</strong>: This tool is meant for researchers
validating TE properties or comparing results across different ED
settings.</li>
<li>
<strong>Limitation</strong>: The heatmap does not naturally handle
different units and it is recommended to only simulate one unit per
heatmap.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="understanding-heatmap-results">Understanding Heatmap Results<a class="anchor" aria-label="anchor" href="#understanding-heatmap-results"></a>
</h2>
<p>A TE heatmap visualizes how different combinations of sensitivity and
specificity affect TE values. The key patterns we have established so
far are:</p>
<ol style="list-style-type: decimal">
<li>The sum of sensitivity and specificity must exceed 1 for positive TE
values</li>
<li>When this sum exceeds 1, improving sensitivity yields slightly
better gains</li>
<li>When below 1, improving specificity is more beneficial</li>
</ol>
<p>Let’s examine these patterns with a small dataset:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a small sample (1 week) of data</span></span>
<span><span class="va">small_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span><span class="va">sem_malmo_synth</span><span class="op">[</span></span>
<span>  <span class="va">sem_malmo_synth</span><span class="op">$</span><span class="va">arrival</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sem_malmo_synth</span><span class="op">$</span><span class="va">arrival</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="va">sem_malmo_synth</span><span class="op">$</span><span class="va">arrival</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sem_malmo_synth</span><span class="op">$</span><span class="va">arrival</span><span class="op">)</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>,</span>
<span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sem_malmo_synth</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">unit</span> <span class="op">==</span> <span class="st">"medical"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># As noted before - use only one unit per sim.</span></span>
<span></span>
<span><span class="co"># Generate heatmap data</span></span>
<span><span class="co"># WARNING: Even with this small dataset, this may take several minutes</span></span>
<span><span class="va">heatmap_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/sim_heat.html">sim_heat</a></span><span class="op">(</span>n_workers <span class="op">=</span> <span class="fl">12</span>, step_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Creating segments out of dataframe 2025-02-04 19:15:20.353942"</span></span>
<span><span class="co">#&gt; [1] "Identified 907 segments, filtering LOSET cases.."</span></span>
<span><span class="co">#&gt; [1] "Processing 527 segments with LOSET cases"</span></span>
<span><span class="co">#&gt; [1] "Starting simulations with  combinations 2025-02-04 19:15:21.991902"</span></span>
<span><span class="co">#&gt; [1] "Simulations complete 2025-02-04 19:16:06.752344"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_te_heatmap.html">plot_te_heatmap</a></span><span class="op">(</span><span class="va">heatmap_data</span><span class="op">)</span> <span class="co"># Create heatmap</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/example%20of%20heatmap-1.png" alt="A heatmap showing TE over Sensitivity/specificity, unnormalized" width="672"></p>
<p>We can also normalize the heatmap with a single argument:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_te_heatmap.html">plot_te_heatmap</a></span><span class="op">(</span><span class="va">heatmap_data</span>, normalize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Create heatmap</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/example%20of%20heatmap%20-%20normalized-1.png" alt="A heatmap showing TE over Sensitivity/specificity, normalized" width="672">
## Alternative Calculations</p>
<p>The package includes several alternative TE calculations (cube root,
log, median-based) primarily for research validation. These can be
accessed using <code>alt_calc = TRUE</code> in
<code><a href="../reference/sim_heat_alt.html">sim_heat_alt()</a></code>, i.e. it is not possible based on the
<code><a href="../reference/sim_heat.html">sim_heat()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example of alternative calculations</span></span>
<span><span class="va">alt_calc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_heat_alt.html">sim_heat_alt</a></span><span class="op">(</span><span class="va">data</span>, alt_calc <span class="op">=</span> <span class="cn">TRUE</span>, step_size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/plot_te_heatmap.html">plot_te_heatmap</a></span><span class="op">(</span>show_alt_calc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Creating segments out of dataframe 2025-02-04 19:16:07.099449"</span></span>
<span><span class="co">#&gt; [1] "Processing 907 segments."</span></span>
<span><span class="co">#&gt; [1] "Calculating global median from reference simulation 2025-02-04 19:16:08.425164"</span></span>
<span><span class="co">#&gt; [1] "Starting simulations with  combinations 2025-02-04 19:16:12.556122"</span></span>
<span><span class="co">#&gt; [1] "Simulations complete 2025-02-04 19:16:27.061849"</span></span>
<span></span>
<span><span class="va">alt_calc</span><span class="op">$</span><span class="va">te_batch</span> <span class="co"># The first possible alternative heat map</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/example%20alt_calc_1-1.png" alt="The first of three heatmaps from the alternative calculations - plain TE where TE is calculated based on on different normalisation techniques" width="960"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alt_calc</span><span class="op">$</span><span class="va">normalized_te_batch</span> <span class="co"># The second possible alternative heat map</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/example%20alt_calc_2-1.png" alt="The second of three heatmaps from the alternative calculations - normalized TE where TE is calculated based on on different normalisation techniques" width="960"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">alt_calc</span><span class="op">$</span><span class="va">all_batch</span> <span class="co"># The third possible alternative heat map</span></span></code></pre></div>
<p><img src="heatmap_files/figure-html/example%20alt_calc_3-1.png" alt="The second of three heatmaps from the alternative calculations - normalized TE where TE is calculated based on on different normalisation techniques" width="960">
These alternatives help validate that the patterns we observe aren’t
artifacts of our calculation method.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Heatmap analysis in trieff is a powerful research tool for
understanding TE properties, but it requires: 1. Significant
computational resources/patience 2. Careful interpretation of results 3.
Understanding of the theoretical background</p>
<p>For regular TE analysis of your ED, we recommend using the main
<code><a href="../reference/calc_te.html">calc_te()</a></code> function as demonstrated in other vignettes.</p>
<p>For researchers interested in detailed heatmap analysis, we recommend
reviewing the methods section of the TE paper and ensuring sufficient
computational resources before beginning analysis.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by André Johansson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
