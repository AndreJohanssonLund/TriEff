<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation in trieff • trieff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation in trieff">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trieff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/sim_te.html">Simulation in trieff</a></li>
    <li><a class="dropdown-item" href="../articles/calc_wte_rte.html">Calculating Triage Effectiveness</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrap.html">Bootstrap Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/plot_te.html">Plotting Results</a></li>
    <li><a class="dropdown-item" href="../articles/heatmap.html">Heatmap Analysis</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-research" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Research</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-research">
<li><a class="dropdown-item" href="../articles/original_study.html">Original Study (Under Review)</a></li>
    <li><a class="dropdown-item" href="../articles/publications.html">Publications Using trieff</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AndreJohanssonLund/trieff/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation in trieff</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AndreJohanssonLund/trieff/blob/HEAD/vignettes/sim_te.Rmd" class="external-link"><code>vignettes/sim_te.Rmd</code></a></small>
      <div class="d-none name"><code>sim_te.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrejohanssonlund.github.io/TriEff/index.html">trieff</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded trieff 1.2.0</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The trieff package uses simulation as a prestep to the Theoretical
Triage Effectiveness (TTE) calculation by modeling how patients would be
processed if strictly following their assigned priority levels. This
vignette explains how the simulation works and demonstrates its
implementation.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-simulation">Understanding the Simulation<a class="anchor" aria-label="anchor" href="#understanding-the-simulation"></a>
</h2>
<div class="section level3">
<h3 id="key-concepts">Key Concepts<a class="anchor" aria-label="anchor" href="#key-concepts"></a>
</h3>
<p>The simulation calculates theoretical wait times that would occur
if:</p>
<ol style="list-style-type: decimal">
<li><p>Patients were seen strictly in order of priority</p></li>
<li><p>Within the same priority level, patients were seen in order of
arrival</p></li>
<li><p>No post-triage priority changes occurred</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="optimized-implementation">Optimized Implementation<a class="anchor" aria-label="anchor" href="#optimized-implementation"></a>
</h3>
<p>The default simulation (sim_te) optimizes performance by focusing
only on segments containing time-critical (LOSET-positive) cases. This
optimization works because:</p>
<ul>
<li><p>For WTE calculations, we only need to determine the waiting times
of LOSET-positive patients relative to the overall mean waiting time.
The overall mean can be directly calculated from observed wait
times.</p></li>
<li><p>For RTE calculations, we similarly only need to determine the
queue positions of LOSET-positive patients. Non-LOSET segments have no
impact on the RTE metrics.</p></li>
</ul>
<p>This selective simulation approach dramatically reduces computation
time without affecting the accuracy of TE results. For segments without
LOSET cases, the function simply uses the observed wait times, which
produces mathematically equivalent results to fully simulating those
segments. For research purposes where complete queue behavior analysis
is needed, the package also provides sim_te_alt which simulates waiting
times for all patients in all segments.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Let’s start with a basic example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_sem_synth.html">load_sem_synth</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run simulation</span></span>
<span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_te.html">sim_te</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Filtered to 1044 segments with LOSET cases"</span></span>
<span><span class="co">#&gt; [1] "Total LOSET cases: 3843"</span></span>
<span><span class="co">#&gt; [1] "Starting multisession with 1 cores. 2025-06-12 12:46:20.482032"</span></span>
<span><span class="co">#&gt; [1] "Simulations are done! 2025-06-12 12:46:23.584425"</span></span>
<span></span>
<span><span class="co"># Check first few rows</span></span>
<span><span class="va">simulated_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">loset</span>, <span class="va">observed_wait_time</span>, <span class="va">theoretical_wait_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    loset observed_wait_time theoretical_wait_time</span></span>
<span><span class="co">#&gt; 1  FALSE                 76                    83</span></span>
<span><span class="co">#&gt; 2  FALSE                  0                    73</span></span>
<span><span class="co">#&gt; 3  FALSE                 37                   110</span></span>
<span><span class="co">#&gt; 4  FALSE                  0                    68</span></span>
<span><span class="co">#&gt; 5  FALSE                  0                   257</span></span>
<span><span class="co">#&gt; 6  FALSE                 30                    29</span></span>
<span><span class="co">#&gt; 7  FALSE                  0                    69</span></span>
<span><span class="co">#&gt; 8  FALSE                106                    62</span></span>
<span><span class="co">#&gt; 9  FALSE                105                    23</span></span>
<span><span class="co">#&gt; 10 FALSE                202                   188</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulation-parameters">Simulation Parameters<a class="anchor" aria-label="anchor" href="#simulation-parameters"></a>
</h2>
<p>The simulation accepts several parameters:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_te.html">sim_te</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  tte <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># Calculate theoretical wait times (default)</span></span>
<span>  btte <span class="op">=</span> <span class="cn">FALSE</span>,   <span class="co"># Skip binary theoretical calculations</span></span>
<span>  n_workers <span class="op">=</span> <span class="fl">1</span>   <span class="co"># Number of cores for parallel processing, generally this is faster on 1 core.</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Filtered to 1044 segments with LOSET cases"</span></span>
<span><span class="co">#&gt; [1] "Total LOSET cases: 3843"</span></span>
<span><span class="co">#&gt; [1] "Starting multisession with 1 cores. 2025-06-12 12:46:23.840171"</span></span>
<span><span class="co">#&gt; [1] "Simulations are done! 2025-06-12 12:46:26.877309"</span></span></code></pre></div>
<div class="section level3">
<h3 id="full-simulation-option">Full Simulation Option<a class="anchor" aria-label="anchor" href="#full-simulation-option"></a>
</h3>
<p>For research purposes or when all theoretical wait times are needed,
you can use <code>sim_te_alt</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run full simulation</span></span>
<span><span class="va">full_sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_te_alt.html">sim_te_alt</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting multisession with 1 cores. 2025-06-12 12:46:27.067121"</span></span>
<span><span class="co">#&gt; [1] "Simulations are done! 2025-06-12 12:46:32.53442"</span></span>
<span></span>
<span><span class="co"># First let's show that the mean observed and theoretical wait time is the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">full_sim_data</span><span class="op">$</span><span class="va">observed_wait_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 73.93568</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">full_sim_data</span><span class="op">$</span><span class="va">theoretical_wait_time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 73.93568</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="va">full_sim_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">loset</span>, <span class="va">observed_wait_time</span>, <span class="va">theoretical_wait_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;    loset observed_wait_time theoretical_wait_time</span></span>
<span><span class="co">#&gt; 1  FALSE                 76                    83</span></span>
<span><span class="co">#&gt; 2  FALSE                  0                    73</span></span>
<span><span class="co">#&gt; 3  FALSE                 37                   110</span></span>
<span><span class="co">#&gt; 4  FALSE                  0                    68</span></span>
<span><span class="co">#&gt; 5  FALSE                  0                   257</span></span>
<span><span class="co">#&gt; 6  FALSE                 30                    29</span></span>
<span><span class="co">#&gt; 7  FALSE                  0                    69</span></span>
<span><span class="co">#&gt; 8  FALSE                106                    62</span></span>
<span><span class="co">#&gt; 9  FALSE                105                    23</span></span>
<span><span class="co">#&gt; 10 FALSE                202                   188</span></span></code></pre></div>
<p>The full simulation calculates theoretical wait times for all cases
but takes slightly longer to run. A sharp eye might notice that the wait
times look different than what is shown in the example above. This is
because in sim_te (not the alt version) the theoretical_waiting time is
set to the observed_waiting time for any segment without LOSET cases
that are not simulated. This keeps the mean waiting time identical in
the both columns.</p>
</div>
</div>
<div class="section level2">
<h2 id="performance-considerations">Performance Considerations<a class="anchor" aria-label="anchor" href="#performance-considerations"></a>
</h2>
<p>The optimized simulation offers significant performance benefits:</p>
<ol style="list-style-type: decimal">
<li><p>Reduced computation by focusing on relevant segments</p></li>
<li><p>Lower memory usage</p></li>
<li><p>Faster parallel processing</p></li>
</ol>
<p>However, both approaches produce identical TE values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate TE with both methods</span></span>
<span><span class="va">te_opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_wte.html">calc_wte</a></span><span class="op">(</span><span class="va">simulated_data</span>, overall_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">te_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_wte.html">calc_wte</a></span><span class="op">(</span><span class="va">full_sim_data</span>, overall_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">te_opt</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Triage Effectiveness Analysis Results</span></span>
<span><span class="co">#&gt; ===================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results for Overall </span></span>
<span><span class="co">#&gt; ------------------- </span></span>
<span><span class="co">#&gt; Total patients: 53265 (7.2% LOSET positive)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Classification Metrics:</span></span>
<span><span class="co">#&gt;   Sensitivity: 64.3%</span></span>
<span><span class="co">#&gt;   Specificity: 73.3%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Triage Effectiveness Metrics:</span></span>
<span><span class="co">#&gt;   OTE: 36.3%</span></span>
<span><span class="co">#&gt;   TTE: 49.1%</span></span>
<span><span class="co">#&gt;   OTG: -12.8%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computation Information</span></span>
<span><span class="co">#&gt; =====================</span></span>
<span><span class="co">#&gt; Method: Direct calculation (waiting-time-based)</span></span>
<span><span class="co">#&gt; Calculation time: 2025-06-12 12:46:33.22484</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">te_full</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Triage Effectiveness Analysis Results</span></span>
<span><span class="co">#&gt; ===================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Results for Overall </span></span>
<span><span class="co">#&gt; ------------------- </span></span>
<span><span class="co">#&gt; Total patients: 53265 (7.2% LOSET positive)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Classification Metrics:</span></span>
<span><span class="co">#&gt;   Sensitivity: 64.3%</span></span>
<span><span class="co">#&gt;   Specificity: 73.3%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Triage Effectiveness Metrics:</span></span>
<span><span class="co">#&gt;   OTE: 36.3%</span></span>
<span><span class="co">#&gt;   TTE: 49.1%</span></span>
<span><span class="co">#&gt;   OTG: -12.8%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Computation Information</span></span>
<span><span class="co">#&gt; =====================</span></span>
<span><span class="co">#&gt; Method: Direct calculation (waiting-time-based)</span></span>
<span><span class="co">#&gt; Calculation time: 2025-06-12 12:46:33.235879</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="when-to-use-each-approach">When to Use Each Approach<a class="anchor" aria-label="anchor" href="#when-to-use-each-approach"></a>
</h2>
<p>Use <code>sim_te</code> (default) when:</p>
<ul>
<li><p>Calculating TE metrics</p></li>
<li><p>Processing large datasets</p></li>
</ul>
<p>Use <code>sim_te_alt</code> when:</p>
<ul>
<li><p>Researching queue behavior</p></li>
<li><p>Analyzing non-LOSET wait patterns</p></li>
<li><p>Validating simulation methods</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="technical-details">Technical Details<a class="anchor" aria-label="anchor" href="#technical-details"></a>
</h2>
<p>The simulation uses a non-preemptive approach where:</p>
<ul>
<li><p>Each physician contact becomes an available time slot</p></li>
<li><p>Patients are queued by priority and arrival time</p></li>
<li><p>Wait times are calculated from slot assignment</p></li>
</ul>
<p>This deterministic approach ensures reproducible results while
accurately modeling priority-based queuing.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Understanding simulation in trieff helps you:</p>
<ol style="list-style-type: decimal">
<li><p>Choose the appropriate simulation method</p></li>
<li><p>Interpret results correctly</p></li>
<li><p>Optimize performance for your use case</p></li>
</ol>
<p>For most applications, the default <code>sim_te</code> provides the
most efficient path to accurate TE calculation.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by André Johansson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
