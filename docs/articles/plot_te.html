<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Plotting Triage Effectiveness Results • trieff</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plotting Triage Effectiveness Results">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trieff</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/sim_te.html">Simulation in trieff</a></li>
    <li><a class="dropdown-item" href="../articles/calc_te.html">Calculating Triage Effectiveness</a></li>
    <li><a class="dropdown-item" href="../articles/bootstrap.html">Bootstrap Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/plot_te.html">Plotting Results</a></li>
    <li><a class="dropdown-item" href="../articles/heatmap.html">Heatmap Analysis</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-research" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Research</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-research">
<li><a class="dropdown-item" href="../articles/original_study.html">Original Study (Under Review)</a></li>
    <li><a class="dropdown-item" href="../articles/publications.html">Publications Using trieff</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/AndreJohanssonLund/trieff/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plotting Triage Effectiveness Results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AndreJohanssonLund/trieff/blob/HEAD/vignettes/plot_te.Rmd" class="external-link"><code>vignettes/plot_te.Rmd</code></a></small>
      <div class="d-none name"><code>plot_te.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://AndreJohanssonLund.github.io/trieff/" class="external-link">trieff</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loaded trieff 0.8.7</span></span>
<span><span class="co">#&gt; System capable of parallel processing with multisession backend</span></span>
<span><span class="co">#&gt; Maximum available workers: 16</span></span>
<span><span class="co">#&gt; Note: Individual functions will determine optimal core usage at runtime</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="co"># Initialize and simulate data once at the start</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init.html">init</a></span><span class="op">(</span><span class="va">sem_malmo_synth</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/sim_te.html">sim_te</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Creating segments out of dataframe 2025-02-27 09:50:50.846825"</span></span>
<span><span class="co">#&gt; [1] "Filtered to 1486 segments with LOSET cases"</span></span>
<span><span class="co">#&gt; [1] "Total LOSET cases: 5491"</span></span>
<span><span class="co">#&gt; [1] "Starting multisession with 1 cores. 2025-02-27 09:50:50.986987"</span></span>
<span><span class="co">#&gt; [1] "Simulations are done! 2025-02-27 09:50:55.841043"</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code><a href="../reference/plot_te.html">plot_te()</a></code> function provides flexible visualization
of Triage Effectiveness results. This vignette demonstrates how to
create and customize these visualizations, building on the analyses
shown in the calc_te and bootstrap vignettes.</p>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<ul>
<li>Calculated TE metrics (see <code><a href="../articles/calc_te.html">vignette("calc_te")</a></code>)</li>
<li>Optional: Bootstrap results for confidence intervals (see
<code><a href="../articles/bootstrap.html">vignette("bootstrap")</a></code>)</li>
</ul>
</div>
<div class="section level2">
<h2 id="basic-plotting">Basic Plotting<a class="anchor" aria-label="anchor" href="#basic-plotting"></a>
</h2>
<p>Let’s start with a basic overall TE plot:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate TE metrics</span></span>
<span><span class="va">te_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_te.html">calc_te</a></span><span class="op">(</span><span class="va">data</span>, overall_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create basic plot</span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/basic-plot-1.png" alt="A simple Triage Effectiveness plot" width="672"></p>
<p>By default, the plot shows both Theoretical TE (teal) and Observed TE
(purple) values. The horizontal lines connecting these points represent
the Observed-Theoretical Gap (OTG).</p>
</div>
<div class="section level2">
<h2 id="plotting-bootstrap-results">Plotting Bootstrap Results<a class="anchor" aria-label="anchor" href="#plotting-bootstrap-results"></a>
</h2>
<p>The <code><a href="../reference/plot_te.html">plot_te()</a></code> function automatically handles bootstrap
results when they’re available. Let’s see how this changes the
visualization:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate TE with bootstrap</span></span>
<span><span class="va">te_bootstrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_te.html">calc_te</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                       bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                       overall_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting bootstrap iterations 2025-02-27 09:50:56.748276"</span></span>
<span><span class="co">#&gt; [1] "Bootstrap iterations done 2025-02-27 09:51:15.677778"</span></span>
<span></span>
<span><span class="co"># Plot with confidence intervals</span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_bootstrap</span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/bootstrap-plot-1.png" alt="Triage Effectiveness plot with bootstrap" width="672"></p>
<p>Notice how the plot now includes variability intervals (lighter
shaded areas) for both TTE and OTE. These intervals are derived from the
bootstrap analysis and help visualize the uncertainty in our
estimates.</p>
</div>
<div class="section level2">
<h2 id="subgroup-analysis">Subgroup Analysis<a class="anchor" aria-label="anchor" href="#subgroup-analysis"></a>
</h2>
<p>We can visualize TE patterns across subgroups. Let’s use the age
group example from the calc_te vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create age groups</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">age_at_arrival</span>, </span>
<span>                        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span>, <span class="fl">79</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-59"</span>, <span class="st">"60-79"</span>, <span class="st">"80+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate and plot TE by age group</span></span>
<span><span class="va">te_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_te.html">calc_te</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>                  var1 <span class="op">=</span> <span class="st">"age_group"</span>,</span>
<span>                  bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  overall_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting bootstrap iterations 2025-02-27 09:51:16.210427"</span></span>
<span><span class="co">#&gt; [1] "Bootstrap iterations done 2025-02-27 09:51:36.236595"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_age</span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/subgroup-plot-1.png" alt="Triage Effectiveness based on subgroups with bootstrapping" width="672"></p>
</div>
<div class="section level2">
<h2 id="handling-negative-te-values">Handling Negative TE Values<a class="anchor" aria-label="anchor" href="#handling-negative-te-values"></a>
</h2>
<p>In some cases, particularly when analyzing specific units, we might
encounter negative TE values. This requires special handling of the
plot’s x-axis. Let’s demonstrate this with two plots - one showing only
orthopedic units (which in the SEM synthpop has negative values) and
another showing all units:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, let's get results for orthopedic unit only</span></span>
<span><span class="va">ortho_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">unit</span> <span class="op">==</span> <span class="st">"orthopedics"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">te_ortho</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_te.html">calc_te</a></span><span class="op">(</span><span class="va">ortho_data</span>, bootstrap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting bootstrap iterations 2025-02-27 09:51:36.878078"</span></span>
<span><span class="co">#&gt; [1] "Bootstrap iterations done 2025-02-27 09:51:44.384094"</span></span>
<span></span>
<span><span class="va">data_other</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">unit</span> <span class="op">==</span> <span class="st">"orthopedics"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Then get results for all units minus orthopedics</span></span>
<span><span class="va">te_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_te.html">calc_te</a></span><span class="op">(</span><span class="va">data_other</span>, bootstrap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting bootstrap iterations 2025-02-27 09:51:44.759834"</span></span>
<span><span class="co">#&gt; [1] "Bootstrap iterations done 2025-02-27 09:52:01.404572"</span></span>
<span></span>
<span><span class="co"># Plot orthopedic results</span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_ortho</span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/negative-te-1-1.png" alt="A Triage Effectiveness plot that has negative values naturally" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot all units with adjusted x-axis</span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_all</span>, min_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/negative-te-2-1.png" alt="A Triage Effectiveness plot that has negative values forced" width="672"></p>
<p>Notice how setting <code>min_x = -0.4</code> ensures consistent scale
and alignment between the plots, making it easier to compare results
across different units.</p>
</div>
<div class="section level2">
<h2 id="advanced-plot-customization">Advanced Plot Customization<a class="anchor" aria-label="anchor" href="#advanced-plot-customization"></a>
</h2>
<p>While the default settings are suitable for most purposes,
<code><a href="../reference/plot_te.html">plot_te()</a></code> offers several customization options:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example with custom settings</span></span>
<span><span class="fu"><a href="../reference/plot_te.html">plot_te</a></span><span class="op">(</span><span class="va">te_bootstrap</span>,</span>
<span>        var_alpha <span class="op">=</span> <span class="fl">0.9</span>,          <span class="co"># less transparent variability intervals</span></span>
<span>        dumbell_width <span class="op">=</span> <span class="fl">1.5</span>,      <span class="co"># Thicker connecting lines</span></span>
<span>        label_style <span class="op">=</span> <span class="st">"small"</span>,    <span class="co"># small text labels</span></span>
<span>        title <span class="op">=</span> <span class="st">"Custom TE Plot"</span><span class="op">)</span> <span class="co"># Custom title</span></span></code></pre></div>
<p><img src="plot_te_files/figure-html/customization-1.png" alt="A Triage Effectiveness plot with custom arguments changing its appearance" width="672"></p>
<p>Key customization parameters include:</p>
<ul>
<li><p><code>var_alpha</code>: Controls transparency of variability
intervals (0-1)</p></li>
<li><p><code>dumbell_width</code>: Width of lines connecting TTE and OTE
points</p></li>
<li><p><code>label_style</code>: Can be “none”, “small”, “full”, or
“half” (default)</p></li>
<li><p><code>show_tte</code>/<code>show_ote</code>: Toggle display of
specific metrics</p></li>
<li><p><code>show_var</code>: Toggle display of variability
intervals</p></li>
</ul>
<p>For more details on available parameters, see
<code><a href="../reference/plot_te.html">?plot_te</a></code>.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette has demonstrated how to:</p>
<ol style="list-style-type: decimal">
<li><p>Create basic TE plots</p></li>
<li><p>Visualize bootstrap confidence intervals</p></li>
<li><p>Handle subgroup analyses</p></li>
<li><p>Deal with negative TE values</p></li>
<li><p>Customize plot appearance</p></li>
</ol>
<p>For more complex analyses, consider combining these visualization
techniques with the methods described in the calc_te and bootstrap
vignettes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by André Johansson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
